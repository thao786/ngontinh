%{(require '[ngontinh.libpath :as l]
           '[sodahead.render :as r]
           '[ngontinh.util.truyen :as truyen]
           '[clojure.java.io :as io]
)}


<!DOCTYPE html>
<html lang="en">
<head>

%{ (def path (params :path))
   (def doctruyen-raw (peek (truyen/getTruyen2 (str "SELECT * FROM truyeneng where path ='" path "'"))))
   (def doctruyen (assoc doctruyen-raw :newstate (if (= (compare (doctruyen-raw :state) 1) 0) "Full" "Ongoing")))

   nil}


    <meta charset="utf-8">
    <title>Read %(doctruyen :title) - %(doctruyen :newstate) - %(doctruyen :author) | Trang Ngôn Tình</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <link rel="icon" href="%(l/paths :icon)" type="image/gif" sizes="16x16">
    <!-- Bootstrap -->  
    <link href="%(l/paths :bootcss)" rel="stylesheet" media="screen" type="text/css"> 
    <link rel="stylesheet" href="%(l/paths :bootstheme)">
    <link href="%(l/paths :docscss)" rel="stylesheet">  
    <link href="%(l/paths :bootsresponsive)" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="%(l/paths :stylesheet2)">
    <style>
        body{
          background-image:url("%(l/paths :bgr)"); 
        }  
        @font-face {
          font-family: 'Glyphicons Halflings';
          src:  url('%(l/paths :font1)');
          src:  url('%(l/paths :font1)?#iefix') format('embedded-opentype'), 
                url('%(l/paths :font2)') format('woff'), 
                url('%(l/paths :font3)') format('truetype'), 
                url('%(l/paths :font4)#glyphicons_halflingsregular') format('svg');
        }
    </style>

</head>

<!--================================================== -->
   <body class="maubody1">
<div class="le">  

   %include {"util/pageheader.html"}


  <!--================================================== -->
 

  <div class="row-fluid">     
      <div class="span3 hidden-xs">     


            %(r/render "util/similargenre.html" {:genre (doctruyen :genre)})


            <br>
            <br>

            %(r/render "util/sameauthor.html" {:author (doctruyen :author)})
            
        </div>

           <!--================================================== -->

          <div class="span9">            
            <div class="whiteBgr">
                <div class="row-fluid">
                  <ol class="breadcrumb">
                      <li><a href="%l/hostPath">Home</a></li>
                      <li><a href="%(str l/hostPath "englishnovel/pgnumber/1")">English Novel</a></li>
                      <li class="active">%(doctruyen :title)</li>
                    </ol>
                </div><br>                
                

           <div class="row-fluid">    
              <div class="span4">
                <img src="%(doctruyen :linkanh)" class="thumbnail img-responsive" width="300" height="425">
              </div>
              <div class="span6">
                <a href="%(doctruyen :linktruyen)"><h2 class="green"><b>%(doctruyen :title)</b></h2></a>
                <br>
                <p><i>Author</i>:  <a href="[[(doctruyen :searchauthor)]]">%(doctruyen :author)</a></p>
                <p><i>Genre</i>:  <a href="[[(doctruyen :searchgenre)]]">%(doctruyen :genre)</a></p>
                <p><i>Status</i>:  <a href="[[(doctruyen :searchstate)]]">%(doctruyen :newstate)</a></p>
                <p><i>Source</i>: %(doctruyen :source)</p>
                <p><i>Views</i>: %(doctruyen :view)</p>
                <p><i>Date Added</i>: %(doctruyen :date_added)</p>
              </div>
            </div>         
            

           <div class="row-fluid hidden-xs">
              <div class="span7">
                <h5 class="orange"><b>Latest Chapters</b></h5>    
                <div class="panel panel-success">                
                  <div class="panel-body">

                    %{(defn chuongmoi [linkchap num title]
                        (str "<a href='" linkchap "'>Chap " num ": " title "</a><br>"))


      (def chapmoi (truyen/getChap2 (str "select * from chapeng where truyen = '" (doctruyen :path) "'order by num desc limit 5")))


                        (apply str (for [x chapmoi] 
                            (chuongmoi (x :linkchap) (x :num) (x :title))))
                    }

                  </div>
                </div>  
              </div>          
            </div>

            <br>

             %{ (def overview (slurp (io/resource (str "Stories/" (doctruyen :path) "/Overview.txt")))
               (def raw-first-overview (subs overview 12 (min 300 (count overview))))
               (def first-overview (clojure.string/replace (clojure.string/triml raw-first-overview) #"\n" "<br>"))
               (def remain-overview (clojure.string/replace (subs overview (+ 12 (count raw-first-overview))) #"\n" "<br>"))
               nil
             }


           <h4 class="orange"><b>Overview of </b><i class="green">%(doctruyen :title)</i></h4>
                <div class="well">
                  <p>%first-overview </p>
                  <div id="hiddenBlock" class="anHien">
                    <p>%remain-overview </p>
                  </div>

                  <button id="xemThem" type="button" class="btn btn-default btn-sm btn-block 1">Read More</button>
                </div>           

            <br>

            
               <h4 class="orange"><b>Table of Contents: </b><i class="green">%(doctruyen :title)</i></h4>
                
                <div class="table-responsive">
                  <table class="table table-striped table-hover ">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Chapter Name</th>                        
                        <th>Date Added</th>                        
                      </tr>
                    </thead>
                    <tbody>

                      %{(defn mucluc [num linkchap title date_added]
                         (str "<tr class=''>                  
                                  <td><a href='" linkchap "'>" num "</a></td>
                                  <td><a href='" linkchap "'><b>" title "</b></a></td>
                                  <td>" date_added "</td>
                               </tr>"))

    (def chapter (truyen/getChap2 (str "select * from chapeng where truyen = '" (doctruyen :path) "' order by num asc")))

                            (apply str (for [x chapter] 
                                (mucluc (x :num) (x :linkchap) (x :title) (x :date_added))))
                      }                               
                  
                    </tbody>
                  </table>
                </div>

          
          </div><!--Row-fluid-->

          <br>
          <br>
          

          <div class="row-fluid whiteBgr">    
            <div class="span12">
              <h4 class="white highlight">Comments</h4>    
              <br>
              <form class="form-horizontal">
                  <div class="form-group">
                      <label for="inputEmail" class="control-label col-xs-2">Name</label>
                      <div class="col-xs-4">
                          <input type="email" class="form-control" id="inputEmail" placeholder="Email">
                      </div>
                  </div>

                  <div class="form-group">
                      <label for="inputEmail" class="control-label col-xs-2">Topic</label>
                      <div class="col-xs-4">
                          <input type="email" class="form-control" id="chude" placeholder="Email">
                      </div>
                  </div>

                  <div class="form-group">
                      <label for="inputText" class="control-label col-xs-2">Your Comment</label>
                      <div class="col-xs-10">                
                          <textarea class="form-control" id="myTextarea" rows="3" placeholder="Express yourself here ..."></textarea>
                      </div>
                  </div>
                  
                  <div class="form-group">
                      <div class="col-xs-offset-2 col-xs-10">
                          <button id="cmtbutton" type="button" class="btn btn-default">Post</button>                          
                      </div>
                  </div>
              </form>    

              <hr>              

              </br>
              <div class="media span9" id="try">
                
              </div>
           
            </div><!--Span12-->
  
    </div><!--Span11-->
  </div><!--Row fluid-->


          </div><!--Span9-269-->
    
    
  </div><!--Row fluid-137-->
</div><!--Container fluid-->

</div><!--le-->


%include {"util/footer.html"}

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
     <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
   <!-- <script src="bootstrap.js"></script> 
    <script src="bootstrap-example/js/bootstrap-transition.js"></script>
    <script src="bootstrap-example/js/bootstrap-alert.js"></script>
    <script src="bootstrap-example/js/bootstrap-modal.js"></script>
    <script src="bootstrap-example/js/bootstrap-dropdown.js"></script>
    <script src="bootstrap-example/js/bootstrap-scrollspy.js"></script>
    <script src="bootstrap-example/js/bootstrap-tab.js"></script>
    <script src="bootstrap-example/js/bootstrap-tooltip.js"></script>
    <script src="bootstrap-example/js/bootstrap-popover.js"></script>
    <script src="bootstrap-example/js/bootstrap-button.js"></script>-->
    <script src="%(l/paths :bootcollapsejs)"></script>
   <!--<script src="bootstrap-example/js/bootstrap-carousel.js"></script>
    <script src="bootstrap-example/js/bootstrap-typeahead.js"></script>  -->    
<script>
  
  $("#xemThem").click(function(){
     $("#hiddenBlock").slideToggle();    
  });

  $("#hiendangnhap").click(function(){
        $("#dangnhapblock").slideToggle();    
  });

  $("#cmtbutton").click(function(){
      var cmt = $("#myTextarea").val();
      var d = new Date();
      var tieude = $("#chude").val();
      var ten = $("#ten").val();
      var ngay = d.toLocaleDateString();
      var time = d.toLocaleTimeString();
      $("#try").prepend("<img class='media-object img-circle pull-left' src='image/7.jpg' width='64' height='64'>" +
                        "<div class='media-body'>"+
                          "<span class='heavyText orange'>" + ten + "</span>"+ "<br>"+
                          "<span class='media-heading'>" + tieude + "</span>"+
                          "<span class='bentrai2 text-muted small'>" +"Dang ngay "+ ngay +
                                                                      " luc "+ time +"</span>"+"<br>"+
                            cmt+"</div>"+"<hr>");    
    });

  $(document).ready(function(){
    $(".list-group-item:even").addClass("list-group-item-warning");
    $(".list-group-item:odd").addClass("list-group-item-success");
    $("tr:odd").addClass("success");
  });
  
</script>

  </body>
</html>